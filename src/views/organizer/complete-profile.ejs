<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('../layouts/head', { title: 'Application Status - helloRun' }) %>
  <link rel="stylesheet" href="/css/application-status.css">
  <meta name="description" content="Track your organizer application status on helloRun.">
</head>
<body>
  <%- include('../layouts/nav') %>
  
  <main class="status-page" id="main-content">
    <div class="status-container">
      
      <!-- Header Section with Accessible Icon -->
      <header class="status-header">
        <div class="header-content">
          <h1>Your Organizer Application</h1>
          <p class="header-subtitle">Application ID: <span class="application-id" aria-label="Application identifier"><%= application.applicationId %></span></p>
        </div>
        <div class="header-icon" aria-hidden="true">
          <% if (application.status === 'pending') { %>
            <svg data-lucide="clock" width="48" height="48" aria-label="Pending"></svg>
          <% } else if (application.status === 'under_review') { %>
            <svg data-lucide="eye" width="48" height="48" aria-label="Under review"></svg>
          <% } else if (application.status === 'approved') { %>
            <svg data-lucide="check-circle" width="48" height="48" aria-label="Approved"></svg>
          <% } else if (application.status === 'rejected') { %>
            <svg data-lucide="alert-circle" width="48" height="48" aria-label="Rejected"></svg>
          <% } %>
        </div>
      </header>

      <!-- Status Card -->
      <section class="status-card status-card-<%= application.status %>" aria-labelledby="status-heading">
        <div class="status-badge status-badge-<%= application.status %>">
          <% if (application.status === 'pending') { %>
            <span>Pending Review</span>
          <% } else if (application.status === 'under_review') { %>
            <span>Under Review</span>
          <% } else if (application.status === 'approved') { %>
            <span>Approved</span>
          <% } else if (application.status === 'rejected') { %>
            <span>Rejected</span>
          <% } %>
        </div>

        <div class="status-message">
          <% if (application.status === 'pending') { %>
            <h2 id="status-heading">Your application is waiting to be reviewed</h2>
            <p>Thank you for submitting your organizer application! Our team will review your documents and get back to you within <strong><%= reviewDays %> business days</strong>.</p>
          <% } else if (application.status === 'under_review') { %>
            <h2 id="status-heading">Your application is under review</h2>
            <p>We're currently reviewing your submitted documents. This usually takes <strong><%= reviewDays %> business days</strong>. You'll receive an email once a decision is made.</p>
          <% } else if (application.status === 'approved') { %>
            <h2 id="status-heading" class="success-message">Congratulations! Your application has been approved</h2>
            <p>You're now a verified organizer on helloRun. You can start creating and managing your first event right away.</p>
          <% } else if (application.status === 'rejected') { %>
            <h2 id="status-heading" class="error-message">Your application was not approved</h2>
            <p>Unfortunately, your application did not meet our verification requirements at this time. See the details below for more information.</p>
          <% } %>
        </div>
      </section>

      <!-- Timeline -->
      <section class="timeline-section" aria-labelledby="timeline-heading">
        <h2 class="section-title" id="timeline-heading">Application Timeline</h2>
        
        <div class="timeline">
          <!-- Submitted -->
          <div class="timeline-item completed">
            <div class="timeline-marker" aria-hidden="true">
              <svg data-lucide="check" width="20" height="20"></svg>
            </div>
            <div class="timeline-content">
              <h3>Application Submitted</h3>
              <p class="timeline-date"><%= submittedDate %></p>
              <p class="timeline-description"><%= daysAgo %> day<%= daysAgo !== 1 ? 's' : '' %> ago</p>
            </div>
          </div>

          <!-- Under Review -->
          <div class="timeline-item <%= application.status !== 'pending' ? 'completed' : 'active' %>">
            <div class="timeline-marker" aria-hidden="true">
              <% if (application.status !== 'pending') { %>
                <svg data-lucide="check" width="20" height="20"></svg>
              <% } else { %>
                <div class="timeline-loader" role="status" aria-label="Loading indicator"></div>
              <% } %>
            </div>
            <div class="timeline-content">
              <h3>Under Review</h3>
              <p class="timeline-description">Our team is reviewing your documents</p>
              <% if (application.status === 'pending' || application.status === 'under_review') { %>
                <p class="timeline-estimate">Expected by <strong><%= estimatedDate %></strong></p>
              <% } %>
            </div>
          </div>

          <!-- Decision -->
          <div class="timeline-item <%= (application.status === 'approved' || application.status === 'rejected') ? 'completed' : '' %>">
            <div class="timeline-marker" aria-hidden="true">
              <% if (application.status === 'approved') { %>
                <svg data-lucide="check-circle" width="20" height="20"></svg>
              <% } else if (application.status === 'rejected') { %>
                <svg data-lucide="x-circle" width="20" height="20"></svg>
              <% } else { %>
                <div class="timeline-dot" aria-hidden="true"></div>
              <% } %>
            </div>
            <div class="timeline-content">
              <h3>Review Decision</h3>
              <% if (application.status === 'approved') { %>
                <p class="timeline-description">✓ Your application was approved</p>
                <p class="timeline-date"><%= application.reviewedAt ? new Date(application.reviewedAt).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) : 'Recently' %></p>
              <% } else if (application.status === 'rejected') { %>
                <p class="timeline-description">✗ Your application was not approved</p>
                <p class="timeline-date"><%= application.reviewedAt ? new Date(application.reviewedAt).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) : 'Recently' %></p>
              <% } else { %>
                <p class="timeline-description">Awaiting decision</p>
              <% } %>
            </div>
          </div>
        </div>
      </section>

      <!-- Application Details -->
      <section class="details-section" aria-labelledby="details-heading">
        <h2 class="section-title" id="details-heading">Application Details</h2>
        
        <div class="details-grid">
          <div class="detail-item">
            <label>Business Name</label>
            <p><%= application.businessName %></p>
          </div>

          <div class="detail-item">
            <label>Business Type</label>
            <p>
              <% 
                const typeMap = {
                  'individual': 'Individual/Solo Organizer',
                  'company': 'Company/Commercial',
                  'ngo': 'Non-Profit/NGO',
                  'sports_club': 'Sports Club/Association'
                };
              %>
              <%= typeMap[application.businessType] || application.businessType %>
            </p>
          </div>

          <div class="detail-item">
            <label>Contact Phone</label>
            <p><a href="tel:<%= application.contactPhone %>" aria-label="Call <%= application.contactPhone %>"><%= application.contactPhone %></a></p>
          </div>

          <div class="detail-item">
            <label>Business Registration Number</label>
            <p><%= application.businessRegistrationNumber || 'Not provided' %></p>
          </div>

          <div class="detail-item full-width">
            <label>Business Address</label>
            <p><%= application.businessAddress || 'Not provided' %></p>
          </div>

          <div class="detail-item full-width">
            <label>Additional Information</label>
            <p><%= application.additionalInfo || 'Not provided' %></p>
          </div>

          <div class="detail-item">
            <label>Submission Date</label>
            <p><%= submittedDate %></p>
          </div>

          <div class="detail-item">
            <label>Application Status</label>
            <p>
              <span class="status-badge status-badge-<%= application.status %>">
                <% if (application.status === 'pending') { %>
                  Pending Review
                <% } else if (application.status === 'under_review') { %>
                  Under Review
                <% } else if (application.status === 'approved') { %>
                  Approved
                <% } else if (application.status === 'rejected') { %>
                  Rejected
                <% } %>
              </span>
            </p>
          </div>
        </div>
      </section>

      <!-- Rejection Reason (if rejected) -->
      <% if (application.status === 'rejected' && application.rejectionReason) { %>
        <section class="rejection-section" aria-labelledby="rejection-heading">
          <div class="rejection-header">
            <svg data-lucide="alert-triangle" width="24" height="24" aria-hidden="true"></svg>
            <h3 id="rejection-heading">Rejection Reason</h3>
          </div>
          <p class="rejection-reason"><%= application.rejectionReason %></p>
        </section>
      <% } %>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <% if (application.status === 'approved') { %>
          <a href="/organizer/create-event" class="btn btn-primary">
            <svg data-lucide="plus" width="18" height="18" aria-hidden="true"></svg>
            Create Your First Event
          </a>
          <a href="/organizer/dashboard" class="btn btn-secondary">
            <svg data-lucide="layout-dashboard" width="18" height="18" aria-hidden="true"></svg>
            Go to Dashboard
          </a>
        <% } else if (application.status === 'rejected') { %>
          <a href="/organizer/complete-profile" class="btn btn-primary">
            <svg data-lucide="refresh-cw" width="18" height="18" aria-hidden="true"></svg>
            Reapply
          </a>
          <a href="/" class="btn btn-secondary">
            <svg data-lucide="home" width="18" height="18" aria-hidden="true"></svg>
            Back to Home
          </a>
        <% } else { %>
          <button class="btn btn-refresh" onclick="location.reload()" aria-label="Refresh page to check latest status">
            <svg data-lucide="refresh-cw" width="18" height="18" aria-hidden="true"></svg>
            Refresh Status
          </button>
          <a href="/" class="btn btn-secondary">
            <svg data-lucide="home" width="18" height="18" aria-hidden="true"></svg>
            Back to Home
          </a>
        <% } %>
      </div>

      <!-- Info Box / Support -->
      <aside class="info-box" aria-label="Support information">
        <svg data-lucide="info" width="20" height="20" aria-hidden="true"></svg>
        <div class="info-content">
          <p>
            <strong>Need help?</strong> If you have questions about your application status, 
            please <a href="mailto:<%= typeof adminEmail !== 'undefined' ? adminEmail : 'hellorunonline@gmail.com' %>">contact our support team</a>.
          </p>
        </div>
      </aside>
    </div>
  </main>

  <%- include('../layouts/footer') %>

  <script src="/js/application-status.js"></script>
</body>
</html>