===========================================
DOCUMENT ROLE (SOURCE OF TRUTH)
===========================================
- Purpose: Product planning, roadmap, detailed tasks, and phase accomplishments.
- Update cadence: When priorities change or a milestone is completed.
- Changelog reference: See dir.txt for repository-level change history.

===========================================
STATUS UPDATE (Feb 26, 2026 - Runner Dashboard Data + Refactor)
===========================================

Current reality after latest implementation:

IN PROGRESS:
- Phase 3: Event Creation & Management (advanced)
- Phase 4: Registration System (account flow active; payment-proof still pending)
- Phase 6: Dashboards (runner dashboard now partially data-driven)

Completed in this cycle:
- Runner dashboard now uses real registration data cards:
  - Upcoming events (based on eventStartAt)
  - Past events
  - Activity log (recent registrations)
  - Progress statistics (total/upcoming/past/unpaid/paid)
- Continue Payment placeholder CTA added:
  - shown only when paymentStatus is unpaid
  - links to /my-registrations for now
- Profile completeness flow added:
  - percentage progress bar
  - required-field completion count
  - missing fields list
- Runner routes/controller refactor completed:
  - moved runner dashboard/profile handlers out of authRoutes.js
  - created dedicated:
    - src/routes/runner.routes.js
    - src/controllers/runner.controller.js
    - src/services/runner-data.service.js
- Runner data source unified:
  - shared registration fetch service now reused by:
    - /runner/dashboard
    - /my-registrations
- Running group feature placeholder added on dashboard:
  - "Running groups (create/join) coming soon."

Still pending from this scope:
- Payment proof upload + organizer verification workflow (Phase 4)
- Runner activity expansion beyond registration events (future)
- Running group backend (create/join/search) implementation (future)

Manual smoke checklist (latest):
[ ] Runner dashboard loads without errors for users with 0 registrations
[ ] Upcoming/Past split follows eventStartAt correctly
[ ] Continue Payment appears only for unpaid registrations
[ ] Profile completeness percentage and missing fields are accurate
[ ] /my-registrations and /runner/dashboard show consistent registration data
[ ] Runner profile update works via new runner routes/controller

---
===========================================
CURRENT ACTIVE BACKLOG (Next 2 Sprints)
===========================================

Sprint A (Immediate):
1. Phase 4 payment proof upload flow (runner side)
2. Organizer payment verification flow (approve/reject + notes)
3. Payment status lifecycle polish in runner and organizer views
4. Smoke tests for registration, waiver, and export flows

Sprint B (After Payment Flow):
1. Runner dashboard iteration 2:
   - richer activity feed (beyond registration events)
   - certificate/stat cards backed by real Phase 5 data when available
2. Running group foundation (placeholder currently in UI):
   - define data model and create/join/search behavior
3. Test coverage:
   - runner profile update
   - runner dashboard data grouping
   - payment workflow regressions

Notes:
- dir.txt should record file-level implementation history only.
- wireframe.txt remains the master planning and task document.

---
How we will build helloRun step-by-step

===========================================
PROJECT OVERVIEW & STATUS (Feb 26, 2026)
===========================================

COMPLETED PHASES:
[DONE] Phase 0: Project Skeleton (Nov 2024) - 100%
[DONE] Phase 1: Authentication System (Feb 2025) - 100%
[DONE] Phase 2A: Organizer Signup Flow - 100%
[DONE] Phase 2B: Organizer Application Forms & Status - 100%

IN PROGRESS:
[IN_PROGRESS] Phase 3: Event Creation & Management (20% scaffolded)
[IN_PROGRESS] Phase 6: Dashboards (runner dashboard data cards + profile completeness implemented)

UPCOMING PHASES:
[PENDING] Phase 4: Registration System (10% scaffolded)
[PENDING] Phase 5: Submission, Results & Leaderboard (0%)
[PENDING] Phase 7: Additional Features (Blog planned, 0% implemented)
[PENDING] Phase 8: Google OAuth (Optional)
[PENDING] Phase 9: Testing & Optimization
[PENDING] Phase 10: Production Deployment

QUICK STATS:
- Total Users: TBD (after deployment)
- Total Events: 0 (awaiting Phase 3)
- Platform Status: Development
- Last Major Update: Feb 26, 2026 (Runner dashboard data cards + runner route/controller refactor)

---

Phase 0: Project skeleton (MVC baseline) [DONE] COMPLETED (Nov 2024)

Goal: You can run the app locally with pages loading.

What you built:
[DONE] Express server
[DONE] EJS views with layouts
[DONE] MVC folders structure
[DONE] MongoDB connection
[DONE] Base layout + navigation + footer components
[DONE] Mobile-responsive navigation with hamburger menu
[DONE] Lucide icons integration
[DONE] Google Analytics integration (GA4)

What you have after Phase 0:
[DONE] / home page (fully styled with hero, features, audience sections)
[DONE] /events events page (UI ready for dynamic content)
[DONE] /login and /signup pages (fully functional UI with improved password toggle)
[DONE] /forgot-password page (compact UI, no scrolling required)
[DONE] Complete password reset flow (forgot, reset, success, expired)
[DONE] Complete email verification flow (sent, success, expired, resend)
[DONE] Error page
[DONE] Responsive navigation with mobile menu
[DONE] Footer with links
[DONE] SEO ready (sitemap.xml, robots.txt)
[DONE] Google Analytics 4 tracking on all pages

---

Phase 1: Auth (MongoDB) with email verification [DONE] COMPLETED (100%) - Feb 3, 2025

Goal: Users can sign up, verify email, and log in securely.

Feature 1A: Email/password signup [DONE] COMPLETED (Nov 2024)
[DONE] Create User model with email verification fields
[DONE] Auto-increment userId (U000001, U000002, etc.)
[DONE] Counter model for sequential IDs
[DONE] Hash password with bcrypt
[DONE] Block duplicate email
[DONE] Save role: "runner" or "organiser"
[DONE] Email verification required before login
[DONE] Migration scripts for existing users

Feature 1B: Email verification [DONE] COMPLETED (Dec 2024)
[DONE] Generate verification token on signup
[DONE] Send verification email via Resend
[DONE] /verify-email/:token endpoint
[DONE] Token expiry (24 hours)
[DONE] Resend verification email feature
[DONE] User cannot login until verified
[DONE] Professional email templates

Feature 1C: Password reset [DONE] COMPLETED (Feb 3, 2025)
[DONE] Request password reset
[DONE] Generate reset token (1 hour expiry)
[DONE] Send reset email via Resend
[DONE] Verify reset token
[DONE] Update password
[DONE] Handle expired tokens
[DONE] Rate limiting (3 resets per 24 hours)
[DONE] Email notifications
[DONE] Confirmation email after password reset
[DONE] Professional reset-password UI with strength indicator
[DONE] Real-time password validation
[DONE] Password visibility toggle (eye/eye-off icons)
[DONE] Common password detection
[DONE] Sequential/repeated character detection
[DONE] Accessible form with ARIA support
[DONE] Client-side validation with debouncing
[DONE] Password match validation
[DONE] Animated strength indicator (gradient)

Feature 1D: Session management [DONE] COMPLETED (Nov 2024)
[DONE] express-session with MongoDB store
[DONE] Session timeout (7 days)
[DONE] Remember me option
[DONE] Secure cookies
[DONE] CSRF protection

Feature 1E: Login [DONE] COMPLETED (Dec 2024)
[DONE] Email/password validation
[DONE] Check email verified before login
[DONE] bcrypt password comparison
[DONE] Create session
[DONE] Redirect to dashboard or complete profile
[DONE] Professional login UI with password toggle
[DONE] Error handling and validation
[DONE] Logged-in users redirected away from /login and /signup (Feb 19, 2026)

---

Phase 2: Organiser application + manual approval [DONE] COMPLETED (100%)

Goal: Runner can apply to become organiser. Admin can approve.

Feature 2A: Organiser signup flow [DONE] COMPLETED
[DONE] User signs up and selects "Event Organizer" role
[DONE] Email verification sent (same as runner)
[DONE] After verification, redirect to /organizer/complete-profile
[DONE] Upload service created (multer configuration)
[DONE] File validation (PDF, JPEG, PNG only, max 5MB)
[DONE] Secure file storage in /public/uploads/organizer-docs/

Feature 2B: Document upload & profile completion [DONE] COMPLETED (Feb 14, 2026)
[DONE] 3-step form wizard (Business Info -> Documents -> Review & Confirm)
[DONE] Drag-and-drop file upload with preview
[DONE] File type validation (PDF, JPG, PNG)
[DONE] File size validation (max 5MB)
[DONE] AJAX form submission
[DONE] Application status tracking page with timeline
[DONE] Auto-refresh status every 5 minutes
[DONE] Copy application ID to clipboard
[DONE] Email notification on submission
[DONE] Mobile responsive design
[DONE] Accessibility features

Feature 2C: Admin reviews [DONE] COMPLETED (Feb 24, 2026)
[DONE] Admin dashboard page
[DONE] List all applications
[DONE] Filter by status (pending, under_review, approved, rejected)
[DONE] View application details
[DONE] View uploaded documents
[DONE] Approve/reject with email notifications
[DONE] Admin routes (/admin/applications)
Delivered: controller + UI + email integration + validation hardening (Feb 24, 2026)

---

Phase 3: Event creation (organiser only) [SCAFFOLDED] SCAFFOLDED (20%)

Goal: Organizers can create running events.

[DONE] Event.js model created
[DONE] Registration.js model created
[PENDING] Create event page UI
[PENDING] Event creation controller
[PENDING] Image upload integration
[PENDING] Edit/delete events
[PENDING] Event status management

---

Phase 4: Registration + payment proof [PAYMENT] PENDING

Goal: Runner joins event and uploads payment proof for verification.
[PENDING] Registration form
[PENDING] Upload payment proof
[PENDING] Organiser verifies payment
[PENDING] Email notifications

---

Phase 5: Submissions, Results & Leaderboard [RUNNER] PENDING

Goal: Runner submits run proof, organiser approves, certificate generated, leaderboard populated.
[PENDING] Submit result (distance, time, proof)
[PENDING] Organiser review and approve
[PENDING] Auto-generate certificate PDF
[PENDING] Download certificate
[PENDING] Leaderboard page (top runners, fastest times, event rankings)
[PENDING] Filter leaderboard by event, distance, category
[PENDING] Public leaderboard (visible to all users)
[DONE] /leaderboard route + placeholder page (Feb 19, 2026)
[DONE] Nav link added (Feb 19, 2026)

---

Phase 6: Dashboards & Analytics [ANALYTICS] IN PROGRESS (runner module foundation)

[PENDING] Runner Dashboard (upcoming events, past events, certificates)
[PENDING] Organiser Dashboard (event overview, participant stats)
[PENDING] Admin Dashboard (platform stats, user growth, pending applications)

---

Phase 7: Additional Pages & Features [FEATURES] PENDING

[PENDING] Static pages (/about, /how-it-works, /contact, /faq, /privacy, /terms)
[PENDING] Blog system (model, CRUD, categories, SEO)
[PENDING] Search & filters
[PENDING] Notifications system

---

Phase 8: Google OAuth (Optional) [SECURITY] PENDING
[PENDING] Passport.js integration
[PENDING] Merge accounts (if email exists)

---

Phase 9: Testing & Optimization [TESTING] PENDING
[PENDING] Unit & integration tests
[PENDING] Performance & security audit
[PENDING] Cross-browser & mobile testing

---

Phase 10: Deployment [DEPLOY] PENDING
[PENDING] Production database, SSL, domain (hellorun.online)
[PENDING] Monitoring, backups, launch

---

===========================================
FILES STRUCTURE (Updated Feb 19, 2026)
===========================================

src/
  config/
    db.js
    session.js
  controllers/
    auth.controller.js
    page.controller.js
  middleware/
    auth.middleware.js             <- REWRITTEN Feb 19 (populateAuthLocals, redirectIfAuth, requireAuth, requireAdmin, requireOrganizer, requireApprovedOrganizer)
    role.middleware.js
  models/
    User.js
    user.model.js
    Counter.js
    counter.model.js
    Event.js
    Registration.js
    OrganiserApplication.js
    Submission.js
  routes/
    authRoutes.js                 <- ALL auth routes (login, signup, register, verify, reset, logout)
    pageRoutes.js                 <- Public pages (home, events, blog, about, leaderboard)
    organizer.routes.js           <- Organizer profile & application (Phase 2B)
    event.routes.js               <- Phase 3 (scaffolded)
    admin.routes.js               <- Phase 2C completed (Feb 24, 2026)
  services/
    upload.service.js
    email.service.js
    password.service.js
    token.service.js
    counter.service.js
  scripts/
    initCounter.js
    migrateUserIds.js
    setup-uploads.js
    clean-users.js
  views/
    layouts/
      head.ejs                     <- Reusable head with GA
      nav.ejs                      <- Auth-aware nav with Blog + Leaderboard links
      footer.ejs
      main.ejs
    pages/
      home.ejs                     <- Full landing page (hero, features, how-it-works, CTA)
      events.ejs                   <- Auth-based content
      blog.ejs                     <- Placeholder
      about.ejs                    <- Placeholder
      leaderboard.ejs              <- Placeholder (Phase 5 data)
      index.ejs
    auth/
      login.ejs
      signup.ejs
      forgot-password.ejs
      reset-password.ejs
      reset-password-expired.ejs
      reset-email-sent.ejs
      reset-success.ejs
      resend-verification.ejs
      verify-email-sent.ejs
      verify-email-success.ejs
      verify-email-expired.ejs
      verify-email-result.ejs
    organizer/
      complete-profile.ejs         <- 3-step form wizard
      application-status.ejs       <- Status tracking with timeline
    admin/
      applications-list.ejs        <- Phase 2C completed (Feb 24, 2026)
      application-details.ejs      <- Phase 2C completed (Feb 24, 2026)
    error.ejs
  public/
    css/
      style.css                    <- Global styles + nav user menu
      helloRun.css                 <- Landing page styles
      login.css
      signup.css
      forgot-password.css
      reset-password.css
      events.css
      complete-profile.css
      application-status.css
      verify-email-sent.css
    js/
      main.js
      auth.js
      signup.js
      reset-password.js
      complete-profile.js
      application-status.js
    images/
      helloRun-icon.webp
    uploads/
      .gitkeep
      organizer-docs/
      event-images/
      profile-photos/
    robots.txt
    sitemap.xml
  server.js

.env
.env.example
.gitignore
package.json
package-lock.json
README.md
dir.txt
wireframe.txt
dns.txt
sitemap.md
organiser_flow.txt
user-role-system.txt
sitetheme.txt
seo keywords.txt
current-dir.txt

---

===========================================
TECHNICAL STACK (Updated Feb 19, 2026)
===========================================

Backend:
[DONE] Node.js + Express
[DONE] MongoDB + Mongoose
[DONE] express-session + connect-mongo
[DONE] bcrypt for password hashing
[DONE] Resend for email delivery
[DONE] UUID for token generation
[DONE] multer for file uploads

Frontend:
[DONE] EJS templating
[DONE] Lucide icons
[DONE] Vanilla JavaScript
[DONE] CSS3 with custom properties
[DONE] Mobile-first responsive design

Security:
[DONE] Password hashing (bcrypt)
[DONE] Secure session cookies
[DONE] Email verification required
[DONE] Password reset tokens (1 hour expiry)
[DONE] Rate limiting on password reset (3/24hrs)
[DONE] CSRF protection
[DONE] Input validation and sanitization
[DONE] Common password blocking
[DONE] Auth middleware (populateAuthLocals, redirectIfAuth, requireAuth, role guards)

---

===========================================
AUTH MIDDLEWARE (Updated Feb 19, 2026)
===========================================

File: src/middleware/auth.middleware.js

Exports:
  populateAuthLocals    - Sets res.locals for all views (isAuthenticated, user, isAdmin, isOrganizer, isApprovedOrganizer, isAuthPage)
  redirectIfAuth        - Redirects logged-in users away from /login, /signup (to role-based dashboard)
  requireAuth           - Protects routes requiring login (redirects to /login)
  requireAdmin          - Protects admin-only routes
  requireOrganizer      - Protects organiser-only routes
  requireApprovedOrganizer - Protects approved-organiser-only routes

Usage in server.js:
  app.use(populateAuthLocals)  <- BEFORE all routes
  
Usage in routes:
  router.get('/login', redirectIfAuth, ...)
  router.get('/dashboard', requireAuth, ...)
  router.get('/admin/*', requireAdmin, ...)

---

===========================================
NAVIGATION BEHAVIOR (Updated Feb 19, 2026)
===========================================

Logged Out:
  [Logo] [Home] [Events] [Blog] [Leaderboard] [Login] [Sign Up]

Logged In (Runner):
  [Logo] [Home] [Events] [Blog] [Leaderboard] [Dashboard] [Hi, Name] [Logout]

Logged In (Pending Organizer):
  [Logo] [Home] [Events] [Blog] [Leaderboard] [My Application] [Hi, Name] [Logout]

Logged In (Approved Organizer):
  [Logo] [Home] [Events] [Blog] [Leaderboard] [Dashboard] [Hi, Name] [Logout]

Logged In (Admin):
  [Logo] [Home] [Events] [Blog] [Leaderboard] [Admin] [Hi, Name] [Logout]

Auth Page Redirect:
  Logged-in user visits /login or /signup -> redirected to role-based dashboard

---

===========================================
TIMELINE TRACKING (Updated Feb 24, 2026)
===========================================

Phase 0:  [DONE] Completed - Nov 2024
Phase 1:  [DONE] Completed - Feb 2025
Phase 2A: [DONE] Completed - Dec 2024
Phase 2B: [DONE] Completed - Feb 14, 2026
Phase 2C: [DONE] Completed - Feb 24, 2026
Phase 3:  [NEXT] After Phase 2C
Phase 4:  [NEXT] After Phase 3
Phase 5:  [NEXT] After Phase 4 (includes Leaderboard)
Phase 6:  [NEXT] After Phase 5
Phase 7:  [NEXT] After Phase 6
Phase 8:  [NEXT] Optional
Phase 9:  [NEXT] Before launch
Phase 10: [NEXT] Launch

Estimated remaining: ~17-18 hours

---

===========================================
DEPLOYMENT CHECKLIST (Production Ready)
===========================================

PRE-DEPLOYMENT REQUIREMENTS:
[ ] Environment Variables
  [ ] NODE_ENV=production
  [ ] PORT (assigned by hosting)
  [ ] MONGODB_URI (production database)
  [ ] SESSION_SECRET (strong, random)
  [ ] RESEND_API_KEY (production)
  [ ] EMAIL_FROM (verified domain)
  [ ] GA_MEASUREMENT_ID
  [ ] ADMIN_EMAIL
  [ ] UPLOAD_MAX_SIZE
  [ ] UPLOAD_ALLOWED_TYPES

[ ] Database Setup
  [ ] MongoDB Atlas cluster configured
  [ ] Production database created
  [ ] Database user with proper permissions
  [ ] IP whitelist configured
  [ ] Indexes created
  [ ] Counter collection initialized

[ ] Email Service
  [ ] Resend account verified
  [ ] Domain verified (hellorun.online)
  [ ] DNS records configured (SPF, DKIM)
  [ ] Email templates tested

[ ] Security Hardening
  [ ] Rate limiting (express-rate-limit)
  [ ] Helmet.js for security headers
  [ ] CORS configured
  [ ] Input sanitization
  [ ] Secure session cookies (secure: true, httpOnly: true)

[ ] SSL/HTTPS
  [ ] SSL certificate
  [ ] HTTPS redirect
  [ ] Secure cookies enabled

[ ] Domain & DNS
  [ ] Domain purchased (hellorun.online)
  [ ] DNS A record configured
  [ ] WWW subdomain configured

[ ] Analytics & Monitoring
  [ ] Google Analytics 4 verified
  [ ] Google Search Console configured
  [ ] Sitemap submitted
  [ ] Error tracking (Sentry or similar)
  [ ] Uptime monitoring

---

===========================================
BLOG SYSTEM PLAN (Phase 7B - Future)
===========================================

BlogPost Model:
[PENDING] postId, slug, title, excerpt, content, featuredImage
[PENDING] authorId, category, tags, status (draft/published/archived)
[PENDING] publishedAt, views, readTime, SEO fields

Categories:
[PENDING] Training, Nutrition, Gear, Motivation, Race Tips, Injury Prevention, General

Routes:
[PENDING] GET /blog, GET /blog/:slug (public)
[PENDING] GET/POST /admin/blog/* (admin CRUD)

Dependencies to add:
[PENDING] slugify, rich text editor (TinyMCE or Quill)

---

===========================================
LEADERBOARD PLAN (Phase 5 - Future)
===========================================

Data Source: Approved submissions from Phase 5

Features:
[PENDING] Top runners by total distance
[PENDING] Fastest times per event
[PENDING] Event-specific rankings
[PENDING] Filter by distance category (5K, 10K, 21K, 42K)
[PENDING] Filter by event
[PENDING] Filter by time period (weekly, monthly, all-time)
[PENDING] Public page (visible to all, no login required)
[DONE] /leaderboard route + placeholder page (Feb 19, 2026)
[DONE] Nav link added (Feb 19, 2026)

---

===========================================
DETAILED CHANGELOGS -> See dir.txt
===========================================
All session-by-session changelogs are maintained in dir.txt.
This file (wireframe.txt) focuses on phase plans, architecture, and status tracking.








