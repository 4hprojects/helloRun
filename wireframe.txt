===========================================
STATUS UPDATE (Feb 24, 2026 - Phase 4 Kickoff)
===========================================

Current reality after latest implementation:

IN PROGRESS:
- Phase 3: Event Creation & Management (advanced beyond scaffold; working organizer flows + public published event viewing)
- Phase 4: Registration System (account-required registration flow implemented, payment-proof flow pending)

Completed in this session:
- Public events listing now shows published events from DB
- Public event details page implemented (/events/:slug)
- Registration routes implemented:
  - GET /events/:slug/register (auth required)
  - POST /events/:slug/register (auth required)
- Guard rules implemented:
  - published event required
  - registration window open required
  - allowed participation mode required
  - duplicate registration blocked
- Login return path implemented for protected registration page
- Registration model implemented with unique event+user index and confirmation code
- Registration confirmation email integrated (graceful failure)
- My Registrations page implemented (/my-registrations)

Still pending for Phase 4 completion:
- Payment proof upload and verification workflow
- Organizer-side payment verification screens
- Full registration/payment status lifecycle polish

Manual smoke checklist (latest):
[ ] Published events appear on /events
[ ] Draft/closed events are not publicly accessible by slug
[ ] Login redirect+return for register route works
[ ] New registration succeeds once per account per event
[ ] Duplicate registration is blocked
[ ] Registration appears in /my-registrations

---
How we will build helloRun step-by-step

===========================================
PROJECT OVERVIEW & STATUS (Feb 24, 2026)
===========================================

COMPLETED PHASES:
âœ… Phase 0: Project Skeleton (Nov 2024) - 100%
âœ… Phase 1: Authentication System (Feb 2025) - 100%
âœ… Phase 2A: Organizer Signup Flow - 100%
âœ… Phase 2B: Organizer Application Forms & Status - 100%

IN PROGRESS:
ğŸ”„ Phase 3: Event Creation & Management (20% scaffolded)

UPCOMING PHASES:
â³ Phase 4: Registration System (10% scaffolded)
â³ Phase 5: Submission, Results & Leaderboard (0%)
â³ Phase 6: Dashboards (0%)
â³ Phase 7: Additional Features (Blog planned, 0% implemented)
â³ Phase 8: Google OAuth (Optional)
â³ Phase 9: Testing & Optimization
â³ Phase 10: Production Deployment

QUICK STATS:
- Total Users: TBD (after deployment)
- Total Events: 0 (awaiting Phase 3)
- Platform Status: Development
- Last Major Update: Feb 24, 2026 (Phase 2C admin review hardening completed)

---

Phase 0: Project skeleton (MVC baseline) âœ… COMPLETED (Nov 2024)

Goal: You can run the app locally with pages loading.

What you built:
âœ… Express server
âœ… EJS views with layouts
âœ… MVC folders structure
âœ… MongoDB connection
âœ… Base layout + navigation + footer components
âœ… Mobile-responsive navigation with hamburger menu
âœ… Lucide icons integration
âœ… Google Analytics integration (GA4)

What you have after Phase 0:
âœ… / home page (fully styled with hero, features, audience sections)
âœ… /events events page (UI ready for dynamic content)
âœ… /login and /signup pages (fully functional UI with improved password toggle)
âœ… /forgot-password page (compact UI, no scrolling required)
âœ… Complete password reset flow (forgot, reset, success, expired)
âœ… Complete email verification flow (sent, success, expired, resend)
âœ… Error page
âœ… Responsive navigation with mobile menu
âœ… Footer with links
âœ… SEO ready (sitemap.xml, robots.txt)
âœ… Google Analytics 4 tracking on all pages

---

Phase 1: Auth (MongoDB) with email verification âœ… COMPLETED (100%) - Feb 3, 2025

Goal: Users can sign up, verify email, and log in securely.

Feature 1A: Email/password signup âœ… COMPLETED (Nov 2024)
âœ… Create User model with email verification fields
âœ… Auto-increment userId (U000001, U000002, etc.)
âœ… Counter model for sequential IDs
âœ… Hash password with bcrypt
âœ… Block duplicate email
âœ… Save role: "runner" or "organiser"
âœ… Email verification required before login
âœ… Migration scripts for existing users

Feature 1B: Email verification âœ… COMPLETED (Dec 2024)
âœ… Generate verification token on signup
âœ… Send verification email via Resend
âœ… /verify-email/:token endpoint
âœ… Token expiry (24 hours)
âœ… Resend verification email feature
âœ… User cannot login until verified
âœ… Professional email templates

Feature 1C: Password reset âœ… COMPLETED (Feb 3, 2025)
âœ… Request password reset
âœ… Generate reset token (1 hour expiry)
âœ… Send reset email via Resend
âœ… Verify reset token
âœ… Update password
âœ… Handle expired tokens
âœ… Rate limiting (3 resets per 24 hours)
âœ… Email notifications
âœ… Confirmation email after password reset
âœ… Professional reset-password UI with strength indicator
âœ… Real-time password validation
âœ… Password visibility toggle (eye/eye-off icons)
âœ… Common password detection
âœ… Sequential/repeated character detection
âœ… Accessible form with ARIA support
âœ… Client-side validation with debouncing
âœ… Password match validation
âœ… Animated strength indicator (gradient)

Feature 1D: Session management âœ… COMPLETED (Nov 2024)
âœ… express-session with MongoDB store
âœ… Session timeout (7 days)
âœ… Remember me option
âœ… Secure cookies
âœ… CSRF protection

Feature 1E: Login âœ… COMPLETED (Dec 2024)
âœ… Email/password validation
âœ… Check email verified before login
âœ… bcrypt password comparison
âœ… Create session
âœ… Redirect to dashboard or complete profile
âœ… Professional login UI with password toggle
âœ… Error handling and validation
âœ… Logged-in users redirected away from /login and /signup (Feb 19, 2026)

---

Phase 2: Organiser application + manual approval âœ… COMPLETED (100%)

Goal: Runner can apply to become organiser. Admin can approve.

Feature 2A: Organiser signup flow âœ… COMPLETED
âœ… User signs up and selects "Event Organizer" role
âœ… Email verification sent (same as runner)
âœ… After verification, redirect to /organizer/complete-profile
âœ… Upload service created (multer configuration)
âœ… File validation (PDF, JPEG, PNG only, max 5MB)
âœ… Secure file storage in /public/uploads/organizer-docs/

Feature 2B: Document upload & profile completion âœ… COMPLETED (Feb 14, 2026)
âœ… 3-step form wizard (Business Info â†’ Documents â†’ Review & Confirm)
âœ… Drag-and-drop file upload with preview
âœ… File type validation (PDF, JPG, PNG)
âœ… File size validation (max 5MB)
âœ… AJAX form submission
âœ… Application status tracking page with timeline
âœ… Auto-refresh status every 5 minutes
âœ… Copy application ID to clipboard
âœ… Email notification on submission
âœ… Mobile responsive design
âœ… Accessibility features

Feature 2C: Admin reviews âœ… COMPLETED (Feb 24, 2026)
âœ… Admin dashboard page
âœ… List all applications
âœ… Filter by status (pending, under_review, approved, rejected)
âœ… View application details
âœ… View uploaded documents
âœ… Approve/reject with email notifications
âœ… Admin routes (/admin/applications)
Delivered: controller + UI + email integration + validation hardening (Feb 24, 2026)

---

Phase 3: Event creation (organiser only) ğŸš§ SCAFFOLDED (20%)

Goal: Organizers can create running events.

âœ… Event.js model created
âœ… Registration.js model created
â³ Create event page UI
â³ Event creation controller
â³ Image upload integration
â³ Edit/delete events
â³ Event status management

---

Phase 4: Registration + payment proof ğŸ’³ PENDING

Goal: Runner joins event and uploads payment proof for verification.
â³ Registration form
â³ Upload payment proof
â³ Organiser verifies payment
â³ Email notifications

---

Phase 5: Submissions, Results & Leaderboard ğŸƒ PENDING

Goal: Runner submits run proof, organiser approves, certificate generated, leaderboard populated.
â³ Submit result (distance, time, proof)
â³ Organiser review and approve
â³ Auto-generate certificate PDF
â³ Download certificate
â³ Leaderboard page (top runners, fastest times, event rankings)
â³ Filter leaderboard by event, distance, category
â³ Public leaderboard (visible to all users)
âœ… /leaderboard route + placeholder page (Feb 19, 2026)
âœ… Nav link added (Feb 19, 2026)

---

Phase 6: Dashboards & Analytics ğŸ“Š PENDING

â³ Runner Dashboard (upcoming events, past events, certificates)
â³ Organiser Dashboard (event overview, participant stats)
â³ Admin Dashboard (platform stats, user growth, pending applications)

---

Phase 7: Additional Pages & Features ğŸŒŸ PENDING

â³ Static pages (/about, /how-it-works, /contact, /faq, /privacy, /terms)
â³ Blog system (model, CRUD, categories, SEO)
â³ Search & filters
â³ Notifications system

---

Phase 8: Google OAuth (Optional) ğŸ” PENDING
â³ Passport.js integration
â³ Merge accounts (if email exists)

---

Phase 9: Testing & Optimization ğŸ§ª PENDING
â³ Unit & integration tests
â³ Performance & security audit
â³ Cross-browser & mobile testing

---

Phase 10: Deployment ğŸš€ PENDING
â³ Production database, SSL, domain (hellorun.online)
â³ Monitoring, backups, launch

---

===========================================
FILES STRUCTURE (Updated Feb 19, 2026)
===========================================

src/
  config/
    db.js
    session.js
  controllers/
    auth.controller.js
    page.controller.js
  middleware/
    auth.middleware.js             â† REWRITTEN Feb 19 (populateAuthLocals, redirectIfAuth, requireAuth, requireAdmin, requireOrganizer, requireApprovedOrganizer)
    role.middleware.js
  models/
    User.js
    user.model.js
    Counter.js
    counter.model.js
    Event.js
    Registration.js
    OrganiserApplication.js
    Submission.js
  routes/
    authRoutes.js                 â† ALL auth routes (login, signup, register, verify, reset, logout)
    pageRoutes.js                 â† Public pages (home, events, blog, about, leaderboard)
    organizer.routes.js           â† Organizer profile & application (Phase 2B)
    event.routes.js               â† Phase 3 (scaffolded)
    admin.routes.js               â† Phase 2C completed (Feb 24, 2026)
  services/
    upload.service.js
    email.service.js
    password.service.js
    token.service.js
    counter.service.js
  scripts/
    initCounter.js
    migrateUserIds.js
    setup-uploads.js
    clean-users.js
  views/
    layouts/
      head.ejs                     â† Reusable head with GA
      nav.ejs                      â† Auth-aware nav with Blog + Leaderboard links
      footer.ejs
      main.ejs
    pages/
      home.ejs                     â† Full landing page (hero, features, how-it-works, CTA)
      events.ejs                   â† Auth-based content
      blog.ejs                     â† Placeholder
      about.ejs                    â† Placeholder
      leaderboard.ejs              â† Placeholder (Phase 5 data)
      index.ejs
    auth/
      login.ejs
      signup.ejs
      forgot-password.ejs
      reset-password.ejs
      reset-password-expired.ejs
      reset-email-sent.ejs
      reset-success.ejs
      resend-verification.ejs
      verify-email-sent.ejs
      verify-email-success.ejs
      verify-email-expired.ejs
      verify-email-result.ejs
    organizer/
      complete-profile.ejs         â† 3-step form wizard
      application-status.ejs       â† Status tracking with timeline
    admin/
      applications-list.ejs        â† Phase 2C completed (Feb 24, 2026)
      application-details.ejs      â† Phase 2C completed (Feb 24, 2026)
    error.ejs
  public/
    css/
      style.css                    â† Global styles + nav user menu
      helloRun.css                 â† Landing page styles
      login.css
      signup.css
      forgot-password.css
      reset-password.css
      events.css
      complete-profile.css
      application-status.css
      verify-email-sent.css
    js/
      main.js
      auth.js
      signup.js
      reset-password.js
      complete-profile.js
      application-status.js
    images/
      helloRun-icon.webp
    uploads/
      .gitkeep
      organizer-docs/
      event-images/
      profile-photos/
    robots.txt
    sitemap.xml
  server.js

.env
.env.example
.gitignore
package.json
package-lock.json
README.md
dir.txt
wireframe.txt
dns.txt
sitemap.md
organiser_flow.txt
user-role-system.txt
sitetheme.txt
seo keywords.txt
current-dir.txt

---

===========================================
TECHNICAL STACK (Updated Feb 19, 2026)
===========================================

Backend:
âœ… Node.js + Express
âœ… MongoDB + Mongoose
âœ… express-session + connect-mongo
âœ… bcrypt for password hashing
âœ… Resend for email delivery
âœ… UUID for token generation
âœ… multer for file uploads

Frontend:
âœ… EJS templating
âœ… Lucide icons
âœ… Vanilla JavaScript
âœ… CSS3 with custom properties
âœ… Mobile-first responsive design

Security:
âœ… Password hashing (bcrypt)
âœ… Secure session cookies
âœ… Email verification required
âœ… Password reset tokens (1 hour expiry)
âœ… Rate limiting on password reset (3/24hrs)
âœ… CSRF protection
âœ… Input validation and sanitization
âœ… Common password blocking
âœ… Auth middleware (populateAuthLocals, redirectIfAuth, requireAuth, role guards)

---

===========================================
AUTH MIDDLEWARE (Updated Feb 19, 2026)
===========================================

File: src/middleware/auth.middleware.js

Exports:
  populateAuthLocals    - Sets res.locals for all views (isAuthenticated, user, isAdmin, isOrganizer, isApprovedOrganizer, isAuthPage)
  redirectIfAuth        - Redirects logged-in users away from /login, /signup (to role-based dashboard)
  requireAuth           - Protects routes requiring login (redirects to /login)
  requireAdmin          - Protects admin-only routes
  requireOrganizer      - Protects organiser-only routes
  requireApprovedOrganizer - Protects approved-organiser-only routes

Usage in server.js:
  app.use(populateAuthLocals)  â† BEFORE all routes
  
Usage in routes:
  router.get('/login', redirectIfAuth, ...)
  router.get('/dashboard', requireAuth, ...)
  router.get('/admin/*', requireAdmin, ...)

---

===========================================
NAVIGATION BEHAVIOR (Updated Feb 19, 2026)
===========================================

Logged Out:
  [Logo] [Home] [Events] [Blog] [Leaderboard] [Login] [Sign Up]

Logged In (Runner):
  [Logo] [Home] [Events] [Blog] [Leaderboard] [Dashboard] [Hi, Name] [Logout]

Logged In (Pending Organizer):
  [Logo] [Home] [Events] [Blog] [Leaderboard] [My Application] [Hi, Name] [Logout]

Logged In (Approved Organizer):
  [Logo] [Home] [Events] [Blog] [Leaderboard] [Dashboard] [Hi, Name] [Logout]

Logged In (Admin):
  [Logo] [Home] [Events] [Blog] [Leaderboard] [Admin] [Hi, Name] [Logout]

Auth Page Redirect:
  Logged-in user visits /login or /signup â†’ redirected to role-based dashboard

---

===========================================
TIMELINE TRACKING (Updated Feb 24, 2026)
===========================================

Phase 0:  âœ… Completed - Nov 2024
Phase 1:  âœ… Completed - Feb 2025
Phase 2A: âœ… Completed - Dec 2024
Phase 2B: âœ… Completed - Feb 14, 2026
Phase 2C: âœ… Completed - Feb 24, 2026
Phase 3:  ğŸ”œ After Phase 2C
Phase 4:  ğŸ”œ After Phase 3
Phase 5:  ğŸ”œ After Phase 4 (includes Leaderboard)
Phase 6:  ğŸ”œ After Phase 5
Phase 7:  ğŸ”œ After Phase 6
Phase 8:  ğŸ”œ Optional
Phase 9:  ğŸ”œ Before launch
Phase 10: ğŸ”œ Launch

Estimated remaining: ~17-18 hours

---

===========================================
DEPLOYMENT CHECKLIST (Production Ready)
===========================================

PRE-DEPLOYMENT REQUIREMENTS:
â–¡ Environment Variables
  â–¡ NODE_ENV=production
  â–¡ PORT (assigned by hosting)
  â–¡ MONGODB_URI (production database)
  â–¡ SESSION_SECRET (strong, random)
  â–¡ RESEND_API_KEY (production)
  â–¡ EMAIL_FROM (verified domain)
  â–¡ GA_MEASUREMENT_ID
  â–¡ ADMIN_EMAIL
  â–¡ UPLOAD_MAX_SIZE
  â–¡ UPLOAD_ALLOWED_TYPES

â–¡ Database Setup
  â–¡ MongoDB Atlas cluster configured
  â–¡ Production database created
  â–¡ Database user with proper permissions
  â–¡ IP whitelist configured
  â–¡ Indexes created
  â–¡ Counter collection initialized

â–¡ Email Service
  â–¡ Resend account verified
  â–¡ Domain verified (hellorun.online)
  â–¡ DNS records configured (SPF, DKIM)
  â–¡ Email templates tested

â–¡ Security Hardening
  â–¡ Rate limiting (express-rate-limit)
  â–¡ Helmet.js for security headers
  â–¡ CORS configured
  â–¡ Input sanitization
  â–¡ Secure session cookies (secure: true, httpOnly: true)

â–¡ SSL/HTTPS
  â–¡ SSL certificate
  â–¡ HTTPS redirect
  â–¡ Secure cookies enabled

â–¡ Domain & DNS
  â–¡ Domain purchased (hellorun.online)
  â–¡ DNS A record configured
  â–¡ WWW subdomain configured

â–¡ Analytics & Monitoring
  â–¡ Google Analytics 4 verified
  â–¡ Google Search Console configured
  â–¡ Sitemap submitted
  â–¡ Error tracking (Sentry or similar)
  â–¡ Uptime monitoring

---

===========================================
BLOG SYSTEM PLAN (Phase 7B - Future)
===========================================

BlogPost Model:
â³ postId, slug, title, excerpt, content, featuredImage
â³ authorId, category, tags, status (draft/published/archived)
â³ publishedAt, views, readTime, SEO fields

Categories:
â³ Training, Nutrition, Gear, Motivation, Race Tips, Injury Prevention, General

Routes:
â³ GET /blog, GET /blog/:slug (public)
â³ GET/POST /admin/blog/* (admin CRUD)

Dependencies to add:
â³ slugify, rich text editor (TinyMCE or Quill)

---

===========================================
LEADERBOARD PLAN (Phase 5 - Future)
===========================================

Data Source: Approved submissions from Phase 5

Features:
â³ Top runners by total distance
â³ Fastest times per event
â³ Event-specific rankings
â³ Filter by distance category (5K, 10K, 21K, 42K)
â³ Filter by event
â³ Filter by time period (weekly, monthly, all-time)
â³ Public page (visible to all, no login required)
âœ… /leaderboard route + placeholder page (Feb 19, 2026)
âœ… Nav link added (Feb 19, 2026)

---

===========================================
DETAILED CHANGELOGS â†’ See dir.txt
===========================================
All session-by-session changelogs are maintained in dir.txt.
This file (wireframe.txt) focuses on phase plans, architecture, and status tracking.


